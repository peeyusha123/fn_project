// Function to handle input change in the Reset Username field
function handleResetUsernameInputChange() {
  let isUsernameInLocalStorage;
  const resetUsernameInput = document.getElementById("resetUsername");
  const resetPasswordBtns = document.querySelectorAll(".resetPasswordBtn");

  // Enable the Reset Buttons only if the Reset Username field is not empty
  const isUsernameEmpty = !resetUsernameInput.value.trim();
  const containsSpecialCharacters = /[!@#$%^&*(),.?":{}|<>]/.test(
    resetUsernameInput.value.trim()
  );

  resetPasswordBtns.forEach((btn) => {
    btn.disabled = isUsernameEmpty || containsSpecialCharacters;
  });

  if (
    document.getElementById("passwordResetModal").style.display === "block" &&
    document.getElementById("passwordResetModal").offsetHeight > 0
  ) {
    resetUsernameInput.value = "";
  }

  // Check if the entered username is present in Local Storage
  const enteredUsername = resetUsernameInput.value.trim();
  if (!containsSpecialCharacters && !openPasswordResetModalImmediately) {
    const storedUsernames = JSON.parse(localStorage.getItem("userList")) || [];

    isUsernameInLocalStorage = storedUsernames.some(
      (user) => user.userName === enteredUsername
    );

    // Optionally, you can clear the input field or display an error message
    resetUsernameInput.value = "";
  } else {
    const storedUsernames = JSON.parse(localStorage.getItem("userList")) || [];
    const isUsernameInLocalStorage = storedUsernames.some(
      (user) => user.userName === enteredUsername
    );
    console.log("Username is valid:", enteredUsername);

    if (!isUsernameInLocalStorage) {
      storedUsernames.push({ userName: enteredUsername });
      localStorage.setItem("userList", JSON.stringify(storedUsernames));
    }

    // openPasswordResetModal(enteredUsername);
  }

  if (openPasswordResetModalImmediately) {
    openPasswordResetModal(enteredUsername);
    openPasswordResetModalImmediately = false;
  }

  const storedUsernames = JSON.parse(localStorage.getItem("usernames")) || [];
  isUsernameInLocalStorage = storedUsernames.includes(enteredUsername);

  if (isUsernameInLocalStorage) {
    console.log("Username found in Local Storage:", enteredUsername);
    openPasswordResetModal(enteredUsername);
  } else {
    console.log("Username not found in Local Storage:", enteredUsername);

    // If the username is not found, you can add it to Local Storage
    storedUsernames.push(enteredUsername);
    localStorage.setItem("usernames", JSON.stringify(storedUsernames));

    console.log("Username added to Local Storage:", enteredUsername);
  }
}
