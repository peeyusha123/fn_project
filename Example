//p1.html..
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="p2.css" />

    <title>Login Page</title>
  </head>
  <body>
    <form id="loginForm">
      <label for="username">Username:</label>
      <input
        type="text"
        id="newUsername"
        placeholder="Enter the User Name"
        autocomplete="newUsername"
      />

      <label for="password">Password:</label>
      <input
        type="password"
        id="newPassword"
        placeholder="Enter the Password"
        autocomplete="newPassword"
      />

      <button type="button" id="submitBtn" disabled>Submit</button>
      <button type="button" id="resetBtn" style="display: none">Reset</button>
      <button type="button" id="signupBtn" onclick="openSignUpModal()">
        Sign Up
      </button>

      <button type="button" id="resetPasswordBtn">Password Reset</button>
    </form>

    <div id="signUpModalContainer"></div>
    <div id="signUpModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeSignUpModal()">&times;</span>
        <h2>Sign Up</h2>
        <form id="signUpForm">
          <label for="signupUsername">Username:</label>
          <input
            type="text"
            id="signupUsername"
            placeholder="Enter the User Name"
            autocomplete="signupUsername"
          />

          <label for="signupPassword">Password:</label>
          <input
            type="password"
            id="signupPassword"
            placeholder="Enter the Password"
            autocomplete="signupPassword"
          />

          <button
            type="button"
            id="signupSubmitBtn"
            onclick="submitSignUpForm()"
          >
            Submit
          </button>
          <button type="button" id="signupResetBtn" onclick="resetSignUpForm()">
            Reset
          </button>
          <button type="button" id="resetStorageBtn">Reset Storage</button>
        </form>
      </div>
    </div>
    <script defer src="p3.js"></script>
    <script></script>
  </body>
</html>

//p2.css..
body {
  font-family: Arial, sans-serif;
  background-color: #f4f4f4;
  margin: 0;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
}

form {
  background-color: #fff;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  width: 300px;
  text-align: center;
}

input {
  width: 100%;
  padding: 8px;
  margin: 8px 0;
  box-sizing: border-box;
}

button {
  background-color: #4caf50;
  color: white;
  padding: 10px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

button:disabled {
  background-color: #cccccc;
  cursor: not-allowed;
}

.error {
  color: red;
}

.modal {
  display: none;
  position: fixed;
  z-index: 1;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgb(0, 0, 0);
  background-color: rgba(0, 0, 0, 0.4);
  padding-top: 60px;
}

.modal-content {
  background-color: #fefefe;
  margin: 5% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
}

.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

//p3.js..
document.getElementById("signupPassword").addEventListener("cut", function (e) {
  e.preventDefault();
  showDisabledAlert();
});

document
  .getElementById("signupPassword")
  .addEventListener("copy", function (e) {
    e.preventDefault();
    showDisabledAlert();
  });

document
  .getElementById("signupPassword")
  .addEventListener("paste", function (e) {
    e.preventDefault();
    showDisabledAlert();
  });

document
  .getElementById("signupPassword")
  .addEventListener("contextmenu", function (e) {
    e.preventDefault();
    showDisabledAlert();
  });

function showDisabledAlert() {
  // Show Bootstrap Error alert in the Modal
  const signUpModalContent = document.querySelector(
    "#signUpModal .modal-content"
  );
  signUpModalContent.innerHTML += `
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      Copy, paste, and right-click disabled for the password field.
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
  `;
}

document.getElementById("newUsername").addEventListener("blur", function () {
  validateField("newUsername");
  updateResetButtonVisibility();
  updateSubmitButtonState();
});

document.getElementById("newPassword").addEventListener("blur", function () {
  validateField("newPassword");
  updateResetButtonVisibility();
  updateSubmitButtonState();
});

document.getElementById("submitBtn").addEventListener("click", function () {
  submitForm();
});

document.getElementById("resetBtn").addEventListener("click", function () {
  resetForm();
});

function validateField(field) {
  const element = document.getElementById(field);
  if (element.value.trim() === "") {
    element.style.border = "2px solid red";
  } else {
    element.style.border = "1px solid #ccc";
  }
}

function updateResetButtonVisibility() {
  const usernameField = document.getElementById("newUsername");
  const passwordField = document.getElementById("newPassword");
  const resetButton = document.getElementById("resetBtn");

  if (usernameField.value !== "" && passwordField.value !== "") {
    resetButton.style.display = "inline-block";
  } else {
    resetButton.style.display = "none";
  }
}

function updateSubmitButtonState() {
  const usernameField = document.getElementById("newUsername");
  const passwordField = document.getElementById("newPassword");
  const submitButton = document.getElementById("submitBtn");

  if (usernameField.value === "" && passwordField.value === "") {
    submitButton.disabled = true;
  } else {
    submitButton.disabled = false;
  }
}

function submitForm() {
  const username = document.getElementById("newUsername").value;
  const password = document.getElementById("newPassword").value;

  if (username === "" || password === "") {
    alert("Username and password are mandatory");
    if (username === "") {
      document.getElementById("newUsername").style.border = "2px solid red";
      document.getElementById("newUsername").focus();
    } else {
      document.getElementById("newUsername").style.border = "1px solid #ccc";
      document.getElementById("newPassword").style.border = "2px solid red";
      document.getElementById("newPassword").focus();
    }
    return;
  }

  const userObject = {
    userName: username,
    pwd: password,
  };

  // Retrieve the existing user list from local storage
  let userList = JSON.parse(localStorage.getItem("userList")) || [];

  // Push the new user object to the user list
  userList.push(userObject);

  // Store the updated user list back to local storage
  localStorage.setItem("userList", JSON.stringify(userList));

  console.log("User List after submission:", userList);

  // Additional logic for local storage validation can be added here

  // Log the username and password JSON list data in the console
  console.log(
    "Username and Password JSON List Data:",
    JSON.stringify(userList)
  );
}

function resetForm() {
  document.getElementById("newUsername").value = "";
  document.getElementById("newPassword").value = "";
  updateResetButtonVisibility();
  updateSubmitButtonState();
}
document
  .getElementById("resetStorageBtn")
  .addEventListener("click", function () {
    // Clear the stored local storage list
    localStorage.removeItem("userList");
    console.log("Local Storage List cleared");
  });

function openSignUpModal() {
  const signUpModal = document.getElementById("signUpModal");
  signUpModal.style.display = "block";
}

function closeSignUpModal() {
  const signUpModal = document.getElementById("signUpModal");
  signUpModal.style.display = "none";
}

function submitSignUpForm() {
  const username = document.getElementById("signupUsername").value;
  const password = document.getElementById("signupPassword").value;

  if (!/^[a-zA-Z]+$/.test(username)) {
    // Show Bootstrap Error alert in the Modal
    const signUpModalContent = document.querySelector(
      "#signUpModal .modal-content"
    );
    signUpModalContent.innerHTML += `
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        User Name cannot contain special characters or numbers. Choose another name and try again.
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    `;
    // Place the cursor in the Username Field
    document.getElementById("signupUsername").focus();
    return;
  }
  // Validate password
  const passwordRegex =
    /^(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^])(?=.*\d)[a-zA-Z\d!@#$%^]{8,}$/;
  if (!passwordRegex.test(password)) {
    // Show Bootstrap Error alert in the Modal
    const signUpModalContent = document.querySelector(
      "#signUpModal .modal-content"
    );
    signUpModalContent.innerHTML += `
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      Password must have at least 8 characters, including at least 1 lowercase letter, 1 uppercase letter, 1 digit, and 1 special character (!@#$%^).
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
  `;
    // Place the cursor in the Password Field
    document.getElementById("signupPassword").focus();
    return;
  }
  // Retrieve the existing user list from local storage
  let userList = JSON.parse(localStorage.getItem("userList")) || [];

  // Check if the username already exists
  if (userList.some((user) => user.userName === username)) {
    // Show Bootstrap Error alert in the Modal
    const signUpModalContent = document.querySelector(
      "#signUpModal .modal-content"
    );
    signUpModalContent.innerHTML += `
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        User Name already taken. Choose another name and try again.
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    `;
    // Place the cursor in the Username Field
    document.getElementById("signupUsername").focus();
    return;
  }

  const userObject = {
    userName: username,
    pwd: password,
  };

  // Push the new user object to the user list
  userList.push(userObject);

  // Store the updated user list back to local storage
  localStorage.setItem("userList", JSON.stringify(userList));

  console.log("User List after signup:", userList);

  // Close the modal after successful signup
  closeSignUpModal();

  // Show Bootstrap Success alert in the Modal on the Top of Login Screen
  const loginForm = document.getElementById("loginForm");
  loginForm.insertAdjacentHTML(
    "afterbegin",
    `
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        User is created.
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    `
  );

  // Set timeout to remove the success alert after 5 seconds
  setTimeout(() => {
    document.querySelector(".alert-success").remove();
  }, 5000);
}
